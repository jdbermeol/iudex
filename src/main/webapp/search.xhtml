<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./templates/template.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <f:metadata>
        <f:viewParam name="query" value="#{search.query}"/>
        <f:event type="preRenderView" listener="#{search.preRenderView()}" />
    </f:metadata>
    
    <ui:define name="content">
        <div class="panel">
            <h:form id="searchForm2">
                Para buscar un curso ingresa el nombre del profesor o de la materia.<br/><br/>
                <h:panelGrid columns="3">
                   <label for="query">Buscar</label>
                   <h:inputText id="query" class="input-large"  value="#{search.query}" />                   
                   <h:commandButton actionListener="#{search.getResults()}" value="Buscar" />
                </h:panelGrid>
            </h:form>
        </div>
       <c:choose>
           <!--When the query is not null or empty-->
           <c:when test="#{!search.isQueryEmpty()}">
               <div class="panel">
                   <h2>Reporte de resultados</h2>
                   La consulta arrojo #{search.courses.size()} resultados para "#{search.query}".
                   <hr size="5" noshade="noshade" />
                <c:choose>
                    <!--When no data found-->
                    <c:when test="#{search.isCoursesEmpty()}">
                        No se encontraron resultados para "#{search.query}".
                    </c:when>
                    <!--When The query gets results Print them-->
                    <c:otherwise>
                        <table class="table">
                            <tr>
                                <th>Periodo</th>
                                <th>Profesor</th>
                                <th>Materia</th>
                                <th>Promedio</th>
                                <th>Seleccionar</th>
                            </tr>
                        <ui:repeat value="#{search.courses}" var="course" varStatus="loop">
                            <tr>
                                <td>#{course.id}</td>
                                <td>#{course.professor.fullName}</td>
                                <td>(#{course.subject.id}) #{course.subject.name}</td>
                                <td>#{course.ratingAverage}</td>
                                <td><a href="/courses/view.xhtml?id=#{course.id}">Seleccionar</a></td>
                            </tr>
                        </ui:repeat>
                        </table>
                    </c:otherwise>
                </c:choose>
               </div>
           </c:when>
       </c:choose>
    </ui:define>

</ui:composition>
